use Test::More;
use Test::Mojo;
use Mojo::Base -strict;
use Mojo::File;
use Carp::Always;
use lib '.';
use Data::Dumper;
$ENV{COMMON_CONFIG_DIR} ='t/etc';
$ENV{MOJO_CONFIG} = 't/etc/mojo.conf';
$ENV{TEST_INSECURE_COOKIES}=1;
my $t = Test::Mojo->new(Mojo::File->new('script/web-login.pl'));
#$t->ua->tx->req->headers('X-Original-URI' => 'https://baedi.no');
$t->get_ok('/login')->status_is(200);
$t->post_ok('/login'=>form=>{user => 'marcus',pass => 'lulz'})->status_is(302)->content_is('');
my $tx = $t->tx;
#is($tx->res->headers->header('Set-Cookie'),'x');
$t->get_ok($tx->res->headers->header('Location'))->status_is(200);
#print STDERR Dumper $tx;
$t->get_ok('/?redirect_uri=/test')->status_is(302);
$tx = $t->tx;
is($tx->res->headers->header('Location'),'/test');
done_testing();

